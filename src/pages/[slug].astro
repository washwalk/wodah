---
import '../styles/global.css';
import { readFileSync } from 'fs';
import { join } from 'path';
import { wodahConfig } from '../../wodah.config';
import Hero from '../components/Hero.tsx';
import BenefitGrid from '../components/BenefitGrid.tsx';
import ConversionSection from '../components/ConversionSection.tsx';
import SolarCalculator from '../components/SolarCalculator.tsx';
import AnalyticsTracker from '../components/AnalyticsTracker.tsx';
import type { WodahNiche } from '../types.ts';

export async function getStaticPaths() {
  const contentDir = join(process.cwd(), 'content');
  const files = await import('fs').then(fs => fs.readdirSync(contentDir).filter(f => f.endsWith('.json')));
  
  return files.map(file => {
    const slug = file.replace('.json', '');
    const data = JSON.parse(readFileSync(join(contentDir, file), 'utf8'));
    return {
      params: { slug },
      props: { niche: data as WodahNiche },
    };
  });
}

const { niche } = Astro.props as { niche: WodahNiche };

const handleCtaClick = () => {
  // Handle CTA click, perhaps scroll to conversion section
  console.log('CTA clicked for', niche.id);
};

const gaId = wodahConfig.analytics.googleAnalyticsId;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{niche.name}</title>
  </head>
  <body>
    {gaId && <AnalyticsTracker nicheId={niche.id} gaId={gaId} client:load />}
    <Hero
      headline={niche.headline}
      subheadline={niche.subheadline}
      buttonText={niche.buttonText}
      primaryColor={niche.primaryColor}
      heroImage={niche.heroImage}
      onCtaClick={handleCtaClick}
      client:load
    />
    <BenefitGrid benefits={niche.benefits} primaryColor={niche.primaryColor} client:load />
    {niche.id === 'solar-roi-calculator' && (
      <SolarCalculator primaryColor={niche.primaryColor} client:load />
    )}
    <ConversionSection
      emailPlaceholder={niche.emailPlaceholder}
      buttonText={niche.buttonText}
      primaryColor={niche.primaryColor}
      nicheId={niche.id}
      client:load
    />
  </body>
</html>